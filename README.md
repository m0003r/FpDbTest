Текст оригинального тестового задания: [README.txt](README.txt)

# Принятые допущения
- Экранирование работает через `mysqli::real_escape_string` (иначе зачем вообще там mysqli передаётся в запросопостроитель)
- `skip()` не разрешён как элемент массива (для `?a` и  `?#`), выбрасывается исключение
- `skip()` разрешён как единственное значение (`?#`) — кажется, никто в здравом уме так пользоваться этим не будет
- В остальном `?#` позволяет только строки
- Экранирование полей работает через `
- Касты в int и float не вызывают дополнительных проверок, т.е. туда можно передать всё что угодно 
- `skip()` между двумя экземплярами не взаимозаменяем. Если это существенно, можно сделать его `static` 

# Особенности реализации

В тесте лежат две разные реализации: более простая, с использованием `preg_replace_callback` (и прочих плюшек от PCRE), и более выпендрёжная, в которой на PHP реализован несложный конечный автомат.

При этом по результатам измерений оказалось, что реализация на регулярках работает _быстрее_, чем вручную выписанный (и, вроде бы, более оптимальный) конечный автомат. Вероятно, причина этого в том, что внутренняя работа со строками в PCRE быстрее, чем работа со строками в PHP. Впрочем, это не точно. В идеале нужно переписать обе реализации на чём-то более низкоуровневом (например, на Rust), чтобы сравнить их скорость.

# Запуск тестов

Для удобства тестирования всё запаковано в docker-compose (поскольку для тестов требуется живая БД; выбрана MariaDB 11). Запускать тесты так:

```bash
docker compose run tests
```

При этом запускаются:
- оригинальные тесты для двух реализаций
- значительно больше тестов на PHPUnit для обеих реализаций
- мутационное тестирование через Infection
- сравнение скорости через phpBench

У меня получилась следующая картина с бенчмарками:

```
+------------------+---------------------+-----+------+-----+----------+---------+---------+
| benchmark        | subject             | set | revs | its | mem_peak | mode    | rstdev  |
+------------------+---------------------+-----+------+-----+----------+---------+---------+
| PerformanceBench | benchRegExpDatabase | 0   | 1000 | 10  | 1.524mb  | 2.299μs | ±65.45% |
| PerformanceBench | benchRegExpDatabase | 1   | 1000 | 10  | 1.524mb  | 0.892μs | ±6.56%  |
| PerformanceBench | benchRegExpDatabase | 2   | 1000 | 10  | 1.524mb  | 2.203μs | ±53.80% |
| PerformanceBench | benchRegExpDatabase | 3   | 1000 | 10  | 1.524mb  | 2.541μs | ±60.03% |
| PerformanceBench | benchRegExpDatabase | 4   | 1000 | 10  | 1.524mb  | 2.916μs | ±63.87% |
| PerformanceBench | benchRegExpDatabase | 5   | 1000 | 10  | 1.524mb  | 4.473μs | ±67.12% |
| PerformanceBench | benchRegExpDatabase | 6   | 1000 | 10  | 1.524mb  | 4.356μs | ±4.60%  |
| PerformanceBench | benchDFADatabase    | 0   | 1000 | 10  | 1.524mb  | 6.726μs | ±59.31% |
| PerformanceBench | benchDFADatabase    | 1   | 1000 | 10  | 1.524mb  | 4.653μs | ±65.24% |
| PerformanceBench | benchDFADatabase    | 2   | 1000 | 10  | 1.524mb  | 6.605μs | ±42.61% |
| PerformanceBench | benchDFADatabase    | 3   | 1000 | 10  | 1.524mb  | 6.982μs | ±57.73% |
| PerformanceBench | benchDFADatabase    | 4   | 1000 | 10  | 1.524mb  | 6.225μs | ±52.97% |
| PerformanceBench | benchDFADatabase    | 5   | 1000 | 10  | 1.524mb  | 8.381μs | ±44.51% |
| PerformanceBench | benchDFADatabase    | 6   | 1000 | 10  | 1.524mb  | 8.657μs | ±53.06% |
+------------------+---------------------+-----+------+-----+----------+---------+---------+
```

т.е. код на регвырах в среднем стабильно быстрее (хотя rstdev неприлично большой, т.е. бенчмарк выдаёт очень разные результаты)